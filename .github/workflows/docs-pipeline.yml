name: Documentation Pipeline

on:
  workflow_dispatch:
    inputs:
      mode:
        description: "Doc pipeline mode"
        required: false
        default: "DocsOnly"
        type: choice
        options:
          - DocsOnly
          - Full
  push:
    branches: [main, develop]
    paths:
      - "docs/**"
      - "Tools/**"
      - "Modules/**"
      - "README.md"
      - "ARCHITECTURE.md"
      - "CI-CD-GUIDE.md"
      - "CI-CD-SETUP-SUMMARY.md"
      - ".github/workflows/docs-pipeline.yml"

jobs:
  docs:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run Doc Pipeline
        shell: pwsh
        run: |
          $mode = "${{ inputs.mode }}"
          if (-not $mode) { $mode = "DocsOnly" }
          if (Test-Path ".\Tools\Invoke-DocPipeline.ps1") {
            .\Tools\Invoke-DocPipeline.ps1 -Mode $mode
          } else {
            Write-Warning "Invoke-DocPipeline.ps1 not found. Skipping."
          }

      - name: Generate Auto Docs
        shell: pwsh
        run: |
          if (Test-Path ".\Tools\generate-auto-docs.ps1") {
            .\Tools\generate-auto-docs.ps1 -BuildDocs
          } else {
            Write-Warning "generate-auto-docs.ps1 not found. Skipping."
          }

      - name: Generate API Signature Report
        shell: pwsh
        run: |
          if (Test-Path ".\Tools\generate-api-signature-report.ps1") {
            .\Tools\generate-api-signature-report.ps1
          } else {
            Write-Warning "generate-api-signature-report.ps1 not found. Skipping."
          }

      - name: Upload Docs Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: docs-artifacts
          path: |
            Reports/**
            .pcai/**
          if-no-files-found: warn
